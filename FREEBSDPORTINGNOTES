bsd-devel branch

disable libcap2 checks in configure.ac
temporarily disabled gperf in build

replaced type cpu_set_t with cpuset_t in src/shared/util.h
replaced <linux/sched.h> with <sys/sched.h> in src/shared/util.c

address lack of <linux/vt.h> in src/shared/util.c
VT functions are used in vt_disallocate() and chvt(), which are then
employed in src/core/main.c and src/core/execute.c, respectively.
TODO: Replace them.

address lack of <linux/tiocl.h> in src/shared/util.c (linux kernel vconsole defs)
commented for now

<sys/inotify.h> needs to be rm'd and/or replaced with kqueue() where applicable
in util.c this is in acquire_terminal(), same function appears in tty-ask-password-agent
and src/core/execute.c

prctl() usage in util.c must be addressed

temporarily commented out <netinet/ip.h>, will address exact issues as they come up later

replaced <sys/vfs.h> with <sys/mount.h>

temporarily placed (useless on FreeBSD) TMPFS and RAMFS magic values for is_temporary_fs() function
in src/shared/util.c

src/shared/ioprio.h and src/shared/missing.h errors (__NR_ioprio_set, __NR_ioprio_get and
<linux/oom.h>)
used in src/core/execute.[ch], src/core/dbus-execute.c and src/core/load-fragment.c
(commented out until further notice)

whole bunch of undefined names in util.c ->
Removed SIGPWR due to lack of it on non-Linux
Added definitions for IPTOS_*
Replaced cpu_set_t type with cpuset_t
Removed RLIMIT_LOCKS, RLIMIT_SIGPENDING, RLIMIT_MSGQUEUE, RLIMIT_NICE and RLIMIT_RTPRIO
Removed SCHED_IDLE and SCHED_BATCH
Define HOST_NAME_MAX as 255
Remove Linux-specific <termios.h> extensions (IUTF8 and IUCLC)
Comment out K_UNICODE
Remove O_NOATIME modifier for open() [O_NOATIME means don't alter timestamp/last modified]
Replace program_invocation_name() with getprogname()
Commented out KDSETMODE and KD_TEXT ioctl
Comment out KIOCSOUND, replace with ioctl or echo to /dev/speaker later on

<features.h> undefined in src/shared/printf.h removed

<asm/types.h> in src/shared/socket-util.h not found, these are internal
kernel typedefs, removed header

<linux/netlink.h> not found, removed

program_invocation_short_name() in log.c, replace with getprogname()
nl field has incomplete type

removed struct nl header

prctl() usage in pager.c, commented out

comment out netlink table in socket-util.c, rid of AF_NETLINK and nl union member
usages

removed socket_address_is_netlink() and socket_address_parse_netlink(),
later on address function usages in load-fragment.c and socket.c in core

<utmp.h> undefined in utmp-wtmp.c, seems absent, rm and leave
<utmpx.h> only
added definition for RUN_LVL in utmp-wtmp.h, taken from glibc
comment out ETIME, as it's Linux-specific, replace later
remove sid struct member in utmp_put_init_process(), address in execute.c later
remove code, status parameters and ut_exit struct member in utmp_put_dead_process(),
address in execute.c later
edit function declarations in utmp-wtmp.h
remove redundant utmpname() function, path's already set in FreeBSD from <paths.h>
replace updwtmpx() with pututxline()

watchdog.c uses <linux/watchdog.h>
Rid of watchdog.[ch], as they heavily rely on Linux-specific interfaces
later on: address their lack in dbus-manager.c, manager.c, shutdown.c, main.c
and test-watchdog.c

spawn-ask-password-agent.c uses <sys/prctl.h>, removed
appears to be unused
spawn-polkit-agent.c, as well, seemingly unused
hwclock.c, too

hwclock.c needs <linux/rtc.h>, try to duplicate functionality
using FreeBSD interfaces, or ignore for now
hwclock_* functions are used only in main.c and dbus-manager.c
hwclock_get_time() and hwclock_set_time() unused

time-dst.c needs <endian.h>, replace with <sys/endian.h>,
also remove <byteswap.h>

socket-label.c can't find SO_BINDTODEVICE, replace with IP_RECVIF

label.c uses <malloc.h>, instead of <stdlib.h>, replaced

ask-password-api.c uses <sys/inotify.h>

files modified:
	src/shared/util.h
	src/shared/util.c
	src/shared/missing.h
	src/shared/ioprio.h
	src/shared/printf.h
	src/shared/socket-util.h
	src/shared/log.c
	src/shared/pager.c
	src/shared/socket-util.c
	src/shared/utmp-wtmp.c
	src/shared/utmp-wtmp.h
	[removed] src/shared/watchdog.c
	[removed] src/shared/watchdog.h
	src/shared/spawn-ask-password-agent.c
	src/shared/spawn-polkit-agent.c
	src/shared/hwclock.c
	src/shared/time-dst.c
	src/shared/socket-label.c
	src/shared/label.c

----------

Partial list of Linux-specific interfaces in systemd:

cgroups
namespaces
selinux
autofs4
capabilities
udev
oom score adjust
RLIMIT_RTTIME
RLIMIT_RTPRIO
ionice
SCHED_RESET_ON_FORK
/proc/$PID/stat
fanotify
inotify
TIOCVHANGUP
IP_TRANSPORT
audit
F_SETPIPE_SZ
CLONE_xxx
BTRFS_IOC_DEFRAG
PR_SET_NAME
PR_CAPBSET_DROP
PR_SET_PDEATHSIG
PR_GET_SECUREBITS
/proc/$PID/comm
/proc/$PID/cmdline
/proc/cmdline
numerous GNU APIs like asprintf
SOCK CLOEXEC, O CLOEXEC
/proc/$PID/fd
/dev/tty0
TIOCLINUX
VT_ACTIVATE
TIOCNXCL
KDSKBMODE
/dev/random
/dev/char/
openat() and friends
/proc/$PID/root
waitid()
/dev/disk/by-label/
/dev/disk/by-uuid/
/sys/class/tty/console/active
/sys/class/dmi/id
/proc/$PID/cgroup
\033[3J
/dev/rtc
settimeofday() and its semantics
