bsd-devel branch

disable libcap2 checks in configure.ac
temporarily disabled gperf in build

replaced type cpu_set_t with cpuset_t in src/shared/util.h
replaced <linux/sched.h> with <sys/sched.h> in src/shared/util.c

address lack of <linux/vt.h> in src/shared/util.c
VT functions are used in vt_disallocate() and chvt(), which are then
employed in src/core/main.c and src/core/execute.c, respectively.
TODO: Replace them.
removed gettid() in ternary op

address lack of <linux/tiocl.h> in src/shared/util.c (linux kernel vconsole defs)
commented for now

<sys/inotify.h> needs to be rm'd and/or replaced with kqueue() where applicable
in util.c this is in acquire_terminal(), same function appears in tty-ask-password-agent
and src/core/execute.c

prctl() usage in util.c must be addressed

temporarily commented out <netinet/ip.h>, will address exact issues as they come up later

replaced <sys/vfs.h> with <sys/mount.h>

temporarily placed (useless on FreeBSD) TMPFS and RAMFS magic values for is_temporary_fs() function
in src/shared/util.c

src/shared/ioprio.h and src/shared/missing.h errors (__NR_ioprio_set, __NR_ioprio_get and
<linux/oom.h>)
used in src/core/execute.[ch], src/core/dbus-execute.c and src/core/load-fragment.c
(commented out until further notice)

whole bunch of undefined names in util.c ->
Removed SIGPWR due to lack of it on non-Linux
Added definitions for IPTOS_*
Replaced cpu_set_t type with cpuset_t
Removed RLIMIT_LOCKS, RLIMIT_SIGPENDING, RLIMIT_MSGQUEUE, RLIMIT_NICE and RLIMIT_RTPRIO
Removed SCHED_IDLE and SCHED_BATCH
Define HOST_NAME_MAX as 255
Remove Linux-specific <termios.h> extensions (IUTF8 and IUCLC)
Comment out K_UNICODE
Remove O_NOATIME modifier for open() [O_NOATIME means don't alter timestamp/last modified]
Replace program_invocation_name() with getprogname()
Commented out KDSETMODE and KD_TEXT ioctl
Comment out KIOCSOUND, replace with ioctl or echo to /dev/speaker later on

<features.h> undefined in src/shared/printf.h removed

<asm/types.h> in src/shared/socket-util.h not found, these are internal
kernel typedefs, removed header

<linux/netlink.h> not found, removed

program_invocation_short_name() in log.c, replace with getprogname()
nl field has incomplete type

removed struct nl header

prctl() usage in pager.c, commented out

comment out netlink table in socket-util.c, rid of AF_NETLINK and nl union member
usages

removed socket_address_is_netlink() and socket_address_parse_netlink(),
later on address function usages in load-fragment.c and socket.c in core

<utmp.h> undefined in utmp-wtmp.c, seems absent, rm and leave
<utmpx.h> only
added definition for RUN_LVL in utmp-wtmp.h, taken from glibc
comment out ETIME, as it's Linux-specific, replace later
remove sid struct member in utmp_put_init_process(), address in execute.c later
remove code, status parameters and ut_exit struct member in utmp_put_dead_process(),
address in execute.c later
edit function declarations in utmp-wtmp.h
remove redundant utmpname() function, path's already set in FreeBSD from <paths.h>
replace updwtmpx() with pututxline()

watchdog.c uses <linux/watchdog.h>
Rid of watchdog.[ch], as they heavily rely on Linux-specific interfaces
later on: address their lack in dbus-manager.c, manager.c, shutdown.c, main.c
and test-watchdog.c

spawn-ask-password-agent.c uses <sys/prctl.h>, removed
appears to be unused
spawn-polkit-agent.c, as well, seemingly unused
hwclock.c, too

hwclock.c needs <linux/rtc.h>, try to duplicate functionality
using FreeBSD interfaces, or ignore for now
hwclock_* functions are used only in main.c and dbus-manager.c
hwclock_get_time() and hwclock_set_time() unused

time-dst.c needs <endian.h>, replace with <sys/endian.h>,
also remove <byteswap.h>

socket-label.c can't find SO_BINDTODEVICE, replace with IP_RECVIF

label.c uses <malloc.h>, instead of <stdlib.h>, replaced

ask-password-api.c uses <sys/inotify.h> and <sys/signalfd.h>
comment out relevant bits, use SCM_CREDS instead of SCM_CREDENTIALS
SO_PASSCRED undefined, comment out and replace with cmsgcred() Unix
domain socket pass, or similar later on
added <sys/ucred.h> header
replace ucred->uid check with the preferred priv_check_cred() method
(experimental)

sd-journal.c: inotify usage
important: sd_journal_get_fd() and sd_journal_process()
must reimplement later
replaced <sys/vfs.h> with <sys/mount.h>
Defined Linux magic values CODA_SUPER_MAGIC, NCP_SUPER_MAGIC,
NFS_SUPER_MAGIC and SMB_SUPER_MAGIC

sparse-endian.h: switched <endian.h> to <sys/endian.h>
add <sys/types.h>

journal-file.c: replace ENODATA with ENOATTR
replace fdatasync() with fsync()

journal-verify.c: remove GCRYPT conditional code

journal-send.c: replace program_invocation_short_name()
with getprogname(), add <sys/endian.h>

dbus-common.c: epoll() usage
rid of bus_events_to_flags() and bus_flags_to_events()
remove case for ETIME
replace SO_PEERCREDS with SCM_CREDS
replace ucred->uid check with priv_check_cred()
comment out problematic assertion

dbus-loop.c: remove it, as it's unused

journald-kmsg.c: uses /dev/kmsg, remove entirely
references are in journald-syslog.c, journald-stream.c,
journald-server.c, journald-native.c and journald.c

Currently: various errors in journald-syslog.c

files modified:
	src/shared/util.h
	src/shared/util.c
	src/shared/missing.h
	src/shared/ioprio.h
	src/shared/printf.h
	src/shared/socket-util.h
	src/shared/log.c
	src/shared/pager.c
	src/shared/socket-util.c
	src/shared/utmp-wtmp.c
	src/shared/utmp-wtmp.h
	[removed] src/shared/watchdog.c
	[removed] src/shared/watchdog.h
	src/shared/spawn-ask-password-agent.c
	src/shared/spawn-polkit-agent.c
	src/shared/hwclock.c
	src/shared/time-dst.c
	src/shared/socket-label.c
	src/shared/label.c
	src/shared/ask-password-api.c
	src/shared/sparse-endian.h
	src/shared/dbus-common.c
	[removed] src/shared/dbus-loop.c
	[removed] src/shared/dbus-loop.h

	src/journal/sd-journal.c
	src/systemd/sd-journal.h
	src/journal/journal-file.c
	src/journal/journal-verify.c
	src/journal/journal-send.c
	src/journal/journald-syslog.c
	src/journal/journald-stream.c
	src/journal/journald-server.c
	src/journal/journald-server.h
	src/journal/journald-native.c
	src/journal/journald.c
	[removed] src/journal/journald-kmsg.c
	[removed] src/journal/journald-kmsg.h

----------

Partial list of Linux-specific interfaces in systemd:

cgroups
namespaces
selinux
autofs4
capabilities
udev
oom score adjust
RLIMIT_RTTIME
RLIMIT_RTPRIO
ionice
SCHED_RESET_ON_FORK
/proc/$PID/stat
fanotify
inotify
TIOCVHANGUP
IP_TRANSPORT
audit
F_SETPIPE_SZ
CLONE_xxx
BTRFS_IOC_DEFRAG
PR_SET_NAME
PR_CAPBSET_DROP
PR_SET_PDEATHSIG
PR_GET_SECUREBITS
/proc/$PID/comm
/proc/$PID/cmdline
/proc/cmdline
numerous GNU APIs like asprintf
SOCK CLOEXEC, O CLOEXEC
/proc/$PID/fd
/dev/tty0
TIOCLINUX
VT_ACTIVATE
TIOCNXCL
KDSKBMODE
/dev/random
/dev/char/
openat() and friends
/proc/$PID/root
waitid()
/dev/disk/by-label/
/dev/disk/by-uuid/
/sys/class/tty/console/active
/sys/class/dmi/id
/proc/$PID/cgroup
\033[3J
/dev/rtc
settimeofday() and its semantics
